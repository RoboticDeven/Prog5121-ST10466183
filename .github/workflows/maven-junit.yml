name: Java CI - Maven with JUnit 5 (Java 21)

on:
    push:
        branches: [main]
    pull_request:
        branches: [main]

jobs:
    build-and-test:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout Repository
                uses: actions/checkout@v3

            - name: Set up Java
                uses: actions/setup-java@v3
                with:
                    java-version: '21'
                    distribution: 'temurin'

            - name: Build with Maven
                run: mvn -B clean package

            - name: Run Tests
                run: mvn test --fail-at-end

            - name: Publish Test Results
                uses: dorny/test-reporter@v1
                with:
                    name: JUnit Tests
                    path: target/surefire-reports/*.xml
                    reporter: junit
                    fail-on-error: true

            - name: Upload Test Artifacts
                if: always()
                uses: actions/upload-artifact@v3
                with:
                    name: junit-results
                    path: target/surefire-reports/*.xml
